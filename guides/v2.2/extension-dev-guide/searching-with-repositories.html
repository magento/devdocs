<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>Searching with Repositories | Magento 2 Developer Documentation</title>
	<meta name="description" content="Magento 2 Developer Documentation.
">
	<meta http-equiv="last-modified" content="" />

	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,700,600,300,800' rel='stylesheet' type='text/css'>

	<link rel="stylesheet" href="/css/app.css" />
	<link rel="stylesheet" href="/css/print.css" media="print" />
	<link rel="canonical" href="//guides/v2.2/extension-dev-guide/searching-with-repositories.html">

    <!-- WebUI popover css -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/jquery.webui-popover/1.2.1/jquery.webui-popover.min.css">

  <script>
    var baseUrl = "/";
  </script>

	<!-- crazyegg -->
	<script type="text/javascript">
	setTimeout(function(){var a=document.createElement("script");
	var b=document.getElementsByTagName("script")[0];
	a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0038/0321.js?"+Math.floor(new Date().getTime()/3600000);
	a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
	</script>

    <!-- heap analytics -->
    <script type="text/javascript">
        window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
        heap.load("2619540280");
    </script>

	<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="https://magento.com/favicon.ico">
	<link rel="apple-touch-icon" type="image/png" href="https://magento.com/apple-touch-icon.png">
	<link rel="apple-touch-icon" type="image/png" sizes="57x57" href="https://magento.com/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" type="image/png" sizes="72x72" href="https://magento.com/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://magento.com/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" type="image/png" sizes="114x114" href="https://magento.com/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://magento.com/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" type="image/png" sizes="144x144" href="https://magento.com/apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://magento.com/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://magento.com/apple-touch-icon-180x180.png">

</head>
<body>

<header class="site-header">

	<nav id="global-nav">

		<div class="menu-btn"><a class="menu-trigger menu-icon" href="#"></a></div>

		<div class="container">

			<a class="logo" href="/"><img src="/i/m-logo.svg" alt=""><img src="/i/magento-logo.svg" alt="Magento" class="magento-logo" /><img src="/i/devdocs-logo.svg" alt="Devdocs" class="devdocs-logo" /></a>

			
<div class="version-switcher dropdown" data-version="2.2">
	<button id="version-switcher-button" class="btn btn-small dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Magento 2.2
	</button>

	<ul class="dropdown-menu dropdown-menu-left" aria-labelledby="version-switcher-button">
	
		<li><a class="dropdown-item" href="/guides/v2.0/extension-dev-guide/repositories.html">Magento 2.0</a></li>
	
		<li><a class="dropdown-item" href="/guides/v2.1/extension-dev-guide/repositories.html">Magento 2.1</a></li>
	
		<li><a class="dropdown-item" href="/guides/v2.2/extension-dev-guide/repositories.html">Magento 2.2</a></li>
	
  </ul>

</div>



			<!-- Main Navigation -->
<div class="nav-main">
  <ul>
    <li class="first">
      <a href="#">Setup and Deployment</a>
        <ul class="menu nav">
          <li><a href="/guides/v2.2/install-gde/bk-install-guide.html">Installation Guide</a></li>
          
          <li class="leaf"><a href="/guides/v2.2/comp-mgr/bk-compman-upgrade-guide.html">Extension Update and System Upgrade Guide</a></li>
          
          <li class="leaf"><a href="/guides/v2.2/config-guide/bk-config-guide.html">Configuration Guide</a></li>
          <li class="leaf"><a href="/guides/v2.2/migration/bk-migration-guide.html">Migration Guide</a></li>
          <li class="leaf"><a href="/guides/v2.2/cloud/bk-cloud.html">Magento Commerce (Cloud) Guide</a></li>
          <li class="leaf"><a href="/magento-release-information.html">Release Information</a></li>
        </ul>
    </li>

    <li>
        <a href="#">Development</a>
        <ul class="menu nav">
          <li class="leaf"><a href="/guides/v2.2/architecture/bk-architecture.html">Architecture Guide</a></li>
          <li class="leaf"><a href="/guides/v2.2/extension-dev-guide/bk-extension-dev-guide.html">PHP Developer Guide</a></li>
          <li class="leaf"><a href="/guides/v2.2/ext-best-practices/bk-ext-best-practices.html">Extension Developer Best Practices</a></li>
          
          <li class="leaf"><a href="/guides/v2.2/b2b/bk-b2b.html">B2B Developer Guide</a></li>
          
          <li><a href="/guides/v2.2/payments-integrations/bk-payments-integrations.html">Payments Integrations</a></li>
          <li class="leaf"><a href="/guides/v2.2/mrg/intro.html">Module Reference Guide</a></li>
          <li class="leaf"><a href="/guides/v2.2/coding-standards/bk-coding-standards.html">Coding Standards</a></li>
          
          <li class="first leaf"><a href="/guides/v2.2/contributor-guide/contributing.html">Contributor Guide</a></li>
        </ul>
    </li>

    <li>
        <a href="#">Frontend</a>
        <ul class="menu nav">
          <li class="first leaf"><a href="/guides/v2.2/frontend-dev-guide/bk-frontend-dev-guide.html">Frontend Developer Guide</a></li>
          
          <li class="leaf"><a href="/guides/v2.2/ui_comp_guide/bk-ui_comps.html">UI Components Guide</a></li>
          
          <li class="leaf"><a href="/guides/v2.2/javascript-dev-guide/bk-javascript-dev-guide.html">JavaScript Developer Guide</a></li>
          <li class="leaf"><a href="/guides/v2.2/pattern-library/bk-pattern.html">Admin Design Pattern Library</a></li>
          <li class="leaf"><a href="/guides/v2.2/design-styleguide/bk-styleguide.html">Admin Style Guide</a></li>
        </ul>
    </li>

    <li>
        <a href="#">API</a>
        <ul class="menu nav">
          <li class="leaf"><a href="/guides/v2.2/get-started/bk-get-started-api.html">Get Started with Magento Web APIs</a></li>
          <li class="leaf"><a href="/guides/v2.2/rest/bk-rest.html">REST API Reference</a></li>
          <li class="leaf"><a href="/guides/v2.2/soap/bk-soap.html">SOAP API Reference</a></li>
        </ul>
    </li>

    <li>
        <a href="#">Testing</a>
        <ul class="menu nav">
          <li class="leaf"><a href="/guides/v2.2/test/testing.html">Magento Testing Guide</a></li>
          <li class="leaf"><a href="/guides/v2.2/mtf/mtf_introduction.html">Functional Testing</a></li>
          <li class="leaf"><a href="/guides/v2.2/test/integration/integration_test_execution.html">Integration Testing</a></li>
          <li class="leaf"><a href="/guides/v2.2/test/js/jasmine.html">JavaScript Unit Testing</a></li>
          <li class="leaf"><a href="/guides/v2.2/test/unit/unit_test_execution.html">PHP Unit Testing</a></li>
          <li class="leaf"><a href="/guides/v2.2/get-started/web-api-functional-testing.html">Web API Functional Testing</a></li>
        </ul>
    </li>

    <li>
      <a href="/guides/v2.2/howdoi/bk-how-do-i.html">How Tos</a>
    </li>

    <li>
      <a href="/videos/">Videos</a>
    </li>
  </ul>
</div><!-- /.nav-main -->


			<div class="search-btn">
				<a class="search-trigger search-icon" href="/search.html"></a>
			</div>

			<form class="quick-search" action="/search.html" method="get">
				<input type="search" name="q" placeholder="Search" autocomplete="off" />
				<a href="#" class="quick-search-close">&times;</a>
			</form>

		</div>

	</nav><!-- #global-nav -->

</header>
<div class="nav-main-fader"></div>


<div id="gl-wrapper">

	<!-- .main-container -->
	<div class="main-container">
		<a id="main-content"></a>


<div class="container">

	<!-- sidebar -->
<aside class="sidebar">
	<a href="#" class="toc-toggler">Table of Contents</a>
	<div class="sidebar-wrapper">



<h4>PHP Developer Guide</h4>
<div class="left-navigation">
    <ul>
    
    

<li class="nav-level1  " id="introduction">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.2/extension-dev-guide/bk-extension-dev-guide.html">Introduction</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="developer-roadmap">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/intro/developers_roadmap.html">Developer roadmap</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="introduction-to-composer">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/intro/intro-composer.html">Introduction to Composer</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="glossary-of-common-terms">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/intro/intro-composer-gloss.html">Glossary of common terms</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="prepare-(development-quick-start)">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.2/extension-dev-guide/prepare/prepare.html">Prepare (development quick start)</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="component-types">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/prepare/dev-modtypes.html">Component types</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="about-component-file-structure">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/prepare/prepare_file-str.html">About component file structure</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="roadmap-for-developing-and-packaging-components">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/prepare/dev-summary.html">Roadmap for developing and packaging components</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="extension-lifecycle">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/prepare/lifecycle.html">Extension lifecycle</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="build">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.2/extension-dev-guide/build/build.html">Build</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="the-di.xml-file">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/build/di-xml-file.html">The di.xml file</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="optimal-development-environment">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/build/optimal-dev-environment.html">Optimal development environment</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="the-composer.json-file">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/build/composer-integration.html">The composer.json file</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="define-your-configuration-files">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/build/required-configuration-files.html">Define your configuration files</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="create-your-component-file-structure">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/build/module-file-structure.html">Create your component file structure</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="register-your-component">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/build/component-registration.html">Register your component</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="urn-schema-validation">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/build/XSD-XML-validation.html">URN schema validation</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="name-your-component">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/build/create_component.html">Name your component</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="component-load-order">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/build/module-load-order.html">Component load order</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="enable-or-disable-your-component">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/build/enable-module.html">Enable or disable your component</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="package">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.2/extension-dev-guide/package/package.html">Package</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="package-a-component">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/package/package_module.html">Package a component</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="upload-your-component-to-the-magento-marketplace">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/package/package_mktpl.html">Upload your component to the Magento Marketplace</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="validate">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.2/extension-dev-guide/validate/validate.html">Validate</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="test-your-component">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/validate/test-module.html">Test your component</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="partial-caching">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.2/extension-dev-guide/cache/partial-caching.html">Partial caching</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="create-custom-cache-engines">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/cache/partial-caching/database-caching.html">Create custom cache engines</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="create-a-cache-type">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/cache/partial-caching/create-cache-type.html">Create a cache type</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="full-page-caching">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.2/extension-dev-guide/cache/page-caching.html">Full page caching</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="public-content">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/cache/page-caching/public-content.html">Public content</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="private-content">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/cache/page-caching/private-content.html">Private content</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="add-cli-commands">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.2/extension-dev-guide/cli-cmds/cli-add.html">Add CLI commands</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="command-naming-guidelines">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/cli-cmds/cli-naming-guidelines.html">Command naming guidelines</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="how-to-add-cli-commands">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/cli-cmds/cli-howto.html">How to add CLI commands</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="staging-(enterprise-edition-only)">

    
    
    
    <a href="/guides/v2.2/extension-dev-guide/staging.html">Staging (Enterprise Edition only)</a>
    

    
</li>


    
    

<li class="nav-level1  " id="component-development">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.2/extension-dev-guide/module-development.html">Component development</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="service-contracts">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/service-contracts/service-contracts.html">Service contracts</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="public-interfaces-&amp;-apis">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/api-concepts.html">Public interfaces &amp; APIs</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="service-contract-design-patterns">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/service-contracts/design-patterns.html">Service contract design patterns</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="dependency-injection">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/depend-inj.html">Dependency injection</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="objectmanager">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/object-manager.html">ObjectManager</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="events-and-observers">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/events-and-observers.html">Events and observers</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="factories">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/factories.html">Factories</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="proxies">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/proxies.html">Proxies</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="code-generation">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/code-generation.html">Code generation</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="eav-and-extension-attributes">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/attributes.html">EAV and extension attributes</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="plugins-(interceptors)">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/plugins.html">Plugins (Interceptors)</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="routing">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/routing.html">Routing</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="indexing">
            
            
            <div class="toggle closed">&nbsp;</div>
            
        
            
            <span>Indexing</span>
            

            
            <ul>
                

                
                
                <li class="nav-level3  " id="indexing-overview">
                    

                    
                    <a  href="/guides/v2.2/extension-dev-guide/indexing.html">Indexing overview</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="indexer-optimization">
                    

                    
                    <a  href="/guides/v2.2/extension-dev-guide/indexer-batch.html">Indexer optimization</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="adding-a-custom-indexer">
                    

                    
                    <a  href="/guides/v2.2/extension-dev-guide/indexing-custom.html">Adding a custom indexer</a>
                    

                    
                </li>
                
                
            </ul>
            
        </li>
        
        
        
        
        <li class="nav-level2  " id="message-queues-(enterprise-edition-only)">
            
            
            <div class="toggle closed">&nbsp;</div>
            
        
            
            <span>Message Queues (Enterprise Edition Only)</span>
            

            
            <ul>
                

                
                
                <li class="nav-level3  " id="message-queues-overview">
                    

                    
                    <a  href="/guides/v2.2/extension-dev-guide/message-queues/message-queues.html">Message queues overview</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="configure-message-queues">
                    

                    
                    <a  href="/guides/v2.2/extension-dev-guide/message-queues/config-mq.html">Configure message Queues</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="migrate-message-queue-configuration">
                    

                    
                    <a  href="/guides/v2.2/extension-dev-guide/message-queues/queue-migration.html">Migrate message queue configuration</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="bulk-operations">
                    

                    
                    <a  href="/guides/v2.2/extension-dev-guide/message-queues/bulk-operations.html">Bulk operations</a>
                    

                    
                </li>
                
                

                
                
                <li class="nav-level3  " id="example-bulk-operations-implementation">
                    

                    
                    <a  href="/guides/v2.2/extension-dev-guide/message-queues/implement-bulk.html">Example bulk operations implementation</a>
                    

                    
                </li>
                
                
            </ul>
            
        </li>
        
        
        
        
        <li class="nav-level2  " id="adding-extension-attributes-to-entity">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/extension_attributes/adding-attributes.html">Adding extension attributes to entity</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2 active " id="searching-with-repositories">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/searching-with-repositories.html">Searching with repositories</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="configure-services-as-web-apis">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/service-contracts/service-to-web-service.html">Configure services as web APIs</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="clear-directories-during-development">
            
            
        
            
            <a href="/guides/v2.2/howdoi/php/php_clear-dirs.html">Clear directories during development</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="adapters">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/adapters.html">Adapters</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="configuration">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <span>Configuration</span>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="sensitive-environemnt-settings">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/configuration/sensitive-and-environment-settings.html">Sensitive Environemnt Settings</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="configuration-importers">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/configuration/importers.html">Configuration Importers</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="framework">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <span>Framework</span>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="serialize-library">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/framework/serializer.html">Serialize Library</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="security">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <span>Security</span>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="xss-prevention">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/xss-protection.html">XSS Prevention</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="non-secure-functions">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/security/non-secure-functions.html">Non-secure functions</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    

<li class="nav-level1  " id="versioning">

    
    <div class="toggle closed">&nbsp;</div>
    
    
    
    <a href="/guides/v2.2/extension-dev-guide/versioning/">Versioning</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="module-version-dependencies">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/versioning/dependencies.html">Module version dependencies</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="codebase-changes">
            
            
        
            
            <a href="/guides/v2.2/extension-dev-guide/versioning/codebase-changes.html">Codebase changes</a>
            

            
        </li>
        
        
    </ul>
    
</li>


    
    </ul>
</div>

	</div>

</aside>


<!-- /sidebar -->


	<section class="content">
		<div class="content-wrap">
			<!-- page-header -->
<section class="page-intro">
	

  <nav class="breadcrumbs">

    <a class="breadcrumb-item" href="/"><span>Home</span></a>

    <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

    <!-- Iteration breadcrumb item -->
    
    

    

      <!-- Skip if root -->
      

      <!-- Get breadcrumb title -->
      

      <!-- SEO data -->
      

      <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">

        
          <a property="item" typeof="WebPage" href="/guides/v2.2/extension-dev-guide/bk-extension-dev-guide.html">
            <span property="name">PHP Developer Guide</span>
          </a>
        

        <meta property="position" content="1" />
      </li>

    

      <!-- Skip if root -->
      

      <!-- Get breadcrumb title -->
      

      <!-- SEO data -->
      

      <li class="breadcrumb-item active" property="itemListElement" typeof="ListItem">

        

          

          <span property="name">Searching with Repositories</span>

        

        <meta property="position" content="2" />
      </li>

    

    



    </ol>

  </nav>



	

	

	<h1 class="page-heading">Searching with Repositories</h1>

  


</section>


			<h3 id="m2devgde-repository-intro">What is a repository?</h3>

<p>Repositories give service requestors the ability to perform create, read, update, and delete (CRUD) operations on entities or a list of entities.
A repository is an example of a <a href="/guides/v2.2/extension-dev-guide/service-contracts/design-patterns.html">service contract</a>, and its implementation is part of the <span term-uuid="41aee03b-a5d5-49c2-8839-894090ef4e86" class="glossary-term" data-toggle="popover">domain</span> layer.</p>

<h4 id="repository-state">Repository state</h4>

<p>A repository should be stateless after instantiation.
This means that every method call should not rely on previous calls nor should it affect later method calls.
Any field contained in the repository class must also be stateless.</p>

<p>If your repository needs to provide functionality that requires state, such as for caching,  use the registry pattern.
A good example that uses this pattern is the <a href="https://github.com/magento/magento2/blob/2.1//app/code/Magento/Customer/Model/ResourceModel/CustomerRepository.php" target="_blank"><code class="highlighter-rouge">CustomerRepository</code></a> class.</p>

<h3 id="m2devgde-search-criteria">Search Criteria</h3>

<p>A Search Criteria is an implementation of the <a href="https://github.com/magento/magento2/blob/2.2/lib/internal/Magento/Framework/Api/SearchCriteriaInterface.php" target="_blank"><code class="highlighter-rouge">SearchCriteriaInterface</code></a> class that allows you to build custom requests with different conditions.</p>

<p>Repositories use this class to retrieve entities based on a matching criteria.</p>

<h4 id="filter">Filter</h4>

<p>The <a href="https://github.com/magento/magento2/blob/2.2/lib/internal/Magento/Framework/Api/Filter.php" target="_blank"><code class="highlighter-rouge">Filter</code></a> class is the smallest part of a Search Criteria.
It allows you to add a custom field, value, and condition type to the criteria.</p>

<p>Example of how to define a Filter:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">$filter
    -&gt;setField("url")
    -&gt;setValue("%magento.com")
    -&gt;setConditionType("like");</code></pre></figure>

<p>This filter will find all urls with the suffix of “magento.com”.</p>

<h4 id="filter-group">Filter Group</h4>

<p>The <a href="https://github.com/magento/magento2/blob/2.2/lib/internal/Magento/Framework/Api/Search/FilterGroup.php" target="_blank"><code class="highlighter-rouge">FilterGroup</code></a> class acts like a collection of Filters that apply one or more criteria to a search.</p>

<p>The boolean <code class="highlighter-rouge">OR</code> statement joins Filters inside a single <strong>Filter Group</strong>.</p>

<p>The boolean <code class="highlighter-rouge">AND</code> statement joins Filter Groups inside a <strong>Search Criteria</strong>.</p>

<p>For example:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">$filter1
    -&gt;setField("url")
    -&gt;setValue("%magento.com")
    -&gt;setConditionType("like");

$filter2
    -&gt;setField("store_id")
    -&gt;setValue("1")
    -&gt;setConditionType("eq");

$filterGroup1-&gt;setFilters([$filter1, $filter2]);

$filter3
    -&gt;setField("url_type")
    -&gt;setValue(1)
    -&gt;setConditionType("eq");

$filterGroup2-&gt;setFilters([$filter3]);

$searchCriteria-&gt;setFilterGroups([$filterGroup1, $filterGroup2]);</code></pre></figure>

<p>The code above creates a Search Criteria with the Filters put together in the following way:<br />
<code class="highlighter-rouge">(url like %magento.com OR store_id eq 1) AND (url_type eq 1)</code></p>

<h4 id="sorting">Sorting</h4>

<p>To apply sorting to the Search Criteria, use the <a href="https://github.com/magento/magento2/blob/2.2/lib/internal/Magento/Framework/Api/SortOrder.php" target="_blank"><code class="highlighter-rouge">SortOrder</code></a> class.</p>

<p>Field and direction make up the two parameters that define a Sort Order object.
The field is the name of the field to sort.
The direction is the method of sorting whose value can be <code class="highlighter-rouge">ASC</code> or <code class="highlighter-rouge">DESC</code>.</p>

<p>The example below defines a Sort Order object that will sort the customer email in ascending order:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">$sortOrder
    -&gt;setField("email")
    -&gt;setDirection("ASC");

$searchCriteria-&gt;setSortOrders([$sortOrder]);</code></pre></figure>

<h4 id="pagination">Pagination</h4>

<p>The <code class="highlighter-rouge">setPageSize</code> function paginates the Search Criteria by limiting the amount of entities it retrieves:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">$searchCriteria-&gt;setPageSize(20); //retrieve 20 or less entities</code></pre></figure>

<p>The <code class="highlighter-rouge">setCurrentPage</code> function sets the current page:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">$searchCriteria
    -&gt;setCurrentPage(20)
    -&gt;setCurrentPage(15); //will show entities from 15-th to 20-th</code></pre></figure>

<h3 id="search-result">Search Result</h3>

<p>The <code class="highlighter-rouge">getList(SearchCriteria $searchCriteria)</code> method defined in your repository should return a Search Result object.
This object is an instance of a class that implements the interface <a href="https://github.com/magento/magento2/blob/2.2/lib/internal/Magento/Framework/Api/SearchResultsInterface.php" target="_blank"><code class="highlighter-rouge">SearchResultInterface</code></a>.</p>

<p>Search Result objects hold the Search Criteria object and the retrieved entities along with information about the total count of found entities regardless of any limitations set in the criteria.</p>

<h3 id="m2devgde-searchcriteria-unify-processing">Search Criteria Unify Processing</h3>

<p>A Collection Processor is an implementation of the <a href="https://github.com/magento/magento2/blob/2.2/lib/internal/Magento/Framework/Api/SearchCriteria/CollectionProcessorInterface.php" target="_blank"><code class="highlighter-rouge">CollectionProcessorInterface</code></a> interface that unifies the application of custom filters, sorting, and paginating.
It contains a one method process that applies a Search Criteria object to an abstract database collection.</p>

<p>You can use <a href="/guides/v2.2/extension-detv-guide/depend-inj.html#configuring-a-type">virtual typing</a> in your <code class="highlighter-rouge">di.xml</code> file to specify the processors used in the Collection Processor.</p>

<h4 id="filter-processor">Filter Processor</h4>

<p>The <a href="https://github.com/magento/magento2/blob/2.2/lib/internal/Magento/Framework/Api/SearchCriteria/CollectionProcessor/FilterProcessor.php" target="_blank"><code class="highlighter-rouge">FilterProcessor</code></a> class applies Filter Groups and their filters to a collection.</p>

<p>Below is the code that applies filters to a collection.
The method applies custom filters for some fields, otherwise it applies <code class="highlighter-rouge">$collection-&gt;addFieldToFilter($fields, $conditions)</code>.</p>

<div class="collapsible"><b class="collapsible-title">Show Code for addFilterGroupToCollection </b><div class="collapsible-content"><figure class="highlight"><pre><code class="language-php" data-lang="php">    /**
     * Add FilterGroup to the collection
     *
     * @param FilterGroup $filterGroup
     * @param AbstractDb $collection
     */
    private function addFilterGroupToCollection(
        FilterGroup $filterGroup,
        AbstractDb $collection
    ) {
        $fields = [];
        $conditions = [];
        foreach ($filterGroup-&gt;getFilters() as $filter) {
            $isApplied = false;
            $customFilter = $this-&gt;getCustomFilterForField($filter-&gt;getField());
            if ($customFilter) {
                $isApplied = $customFilter-&gt;apply($filter, $collection);
            }

            if (!$isApplied) {
                $condition = $filter-&gt;getConditionType() ? $filter-&gt;getConditionType() : 'eq';
                $fields[] = $this-&gt;getFieldMapping($filter-&gt;getField());
                $conditions[] = [$condition =&gt; $filter-&gt;getValue()];
            }
        }

        if ($fields) {
            $collection-&gt;addFieldToFilter($fields, $conditions);
        }
    }</code></pre></figure>
</div></div>

<p>You can configure this class to use a specific custom field mapping and custom filter in the <code class="highlighter-rouge">di.xml</code> file.
The example below uses <span term-uuid="2be50595-c5c7-4b9d-911c-3bf2cd3f7beb" class="glossary-term" data-toggle="popover">dependency injection</span> to create a <span term-uuid="058b2be4-3247-4cb0-860d-6292ce75d1f0" class="glossary-term" data-toggle="popover">virtual type</span> from a Filter Processor that applies the module-specific <a href="https://github.com/magento/magento2/blob/2.2/app/code/Magento/Catalog/Model/Api/SearchCriteria/CollectionProcessor/FilterProcessor/ProductCategoryFilter.php" target="_blank"><code class="highlighter-rouge">ProductCategoryFilter</code></a> on a particular field mapping.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">    <span class="nt">&lt;virtualType</span> <span class="na">name=</span><span class="s">"Magento\Customer\Model\Api\SearchCriteria\CollectionProcessor\GroupFilterProcessor"</span> <span class="na">type=</span><span class="s">"Magento\Framework\Api\SearchCriteria\CollectionProcessor\FilterProcessor"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;arguments&gt;</span>
            <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"customFilters"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"category_id"</span> <span class="na">xsi:type=</span><span class="s">"object"</span><span class="nt">&gt;</span>Magento\Catalog\Model\Api\SearchCriteria\CollectionProcessor\FilterProcessor\ProductCategoryFilter<span class="nt">&lt;/item&gt;</span>
            <span class="nt">&lt;/argument&gt;</span>
            <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"fieldMapping"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"code"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>customer_group_code<span class="nt">&lt;/item&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>customer_group_id<span class="nt">&lt;/item&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"tax_class_name"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>class_name<span class="nt">&lt;/item&gt;</span>
            <span class="nt">&lt;/argument&gt;</span>
        <span class="nt">&lt;/arguments&gt;</span>
    <span class="nt">&lt;/virtualType&gt;</span></code></pre></figure>

<div class="collapsible"><b class="collapsible-title">Show code for ProductCategoryFilter </b><div class="collapsible-content"><figure class="highlight"><pre><code class="language-php" data-lang="php">namespace Magento\Catalog\Model\Api\SearchCriteria\CollectionProcessor\FilterProcessor;

use Magento\Catalog\Model\ResourceModel\Product\Collection;
use Magento\Framework\Api\Filter;
use Magento\Framework\Api\SearchCriteria\CollectionProcessor\FilterProcessor\CustomFilterInterface;
use Magento\Framework\Data\Collection\AbstractDb;

class ProductCategoryFilter implements CustomFilterInterface
{
    /**
     * Apply category_id Filter to Product Collection
     *
     * @param Filter $filter
     * @param AbstractDb $collection
     * @return bool Whether to apply the filter
     **/
    public function apply(Filter $filter, AbstractDb $collection)
    {
        $conditionType = $filter-&gt;getConditionType() ? $filter-&gt;getConditionType() : 'eq';
        $categoryFilter = [$conditionType =&gt; [$filter-&gt;getValue()]];

        /** @var Collection $collection **/
        $collection-&gt;addCategoriesFilter($categoryFilter);

        return true;
    }
}</code></pre></figure>
</div></div>

<table>
  <thead>
    <tr>
      <th>Argument</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">customFilters</code></td>
      <td>An array of filters implementing the <a href="https://github.com/magento/magento2/blob/2.2/lib/internal/Magento/Framework/Api/SearchCriteria/CollectionProcessor/FilterProcessor/CustomFilterInterface.php" target="_blank"><code class="highlighter-rouge">CustomFilterInterface</code></a>. These filters allow you to apply custom logic to a particular abstract database collection.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">fieldMapping</code></td>
      <td>Maps field names defined in the search Criteria to the names in an abstract database collection</td>
    </tr>
  </tbody>
</table>

<h4 id="sorting-processor">Sorting Processor</h4>

<p>The <a href="https://github.com/magento/magento2/blob/2.2/lib/internal/Magento/Framework/Api/SearchCriteria/CollectionProcessor/SortingProcessor.php" target="_blank"><code class="highlighter-rouge">SortingProcessor</code></a> class applies the sorting order of a search criteria to an abstract database collection.</p>

<p>Below is an example of how you can configure a Sorting Processor virtual type in the <code class="highlighter-rouge">di.xml</code> file to use a custom field mapping and default sorting orders.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">    <span class="nt">&lt;virtualType</span> <span class="na">name=</span><span class="s">"Magento\Customer\Model\Api\SearchCriteria\CollectionProcessor\GroupSortingProcessor"</span> <span class="na">type=</span><span class="s">"Magento\Framework\Api\SearchCriteria\CollectionProcessor\SortingProcessor"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;arguments&gt;</span>
            <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"fieldMapping"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"code"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>customer_group_code<span class="nt">&lt;/item&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>customer_group_id<span class="nt">&lt;/item&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"tax_class_name"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>class_name<span class="nt">&lt;/item&gt;</span>
            <span class="nt">&lt;/argument&gt;</span>
            <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"defaultOrders"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>ASC<span class="nt">&lt;/item&gt;</span>
            <span class="nt">&lt;/argument&gt;</span>
        <span class="nt">&lt;/arguments&gt;</span>
    <span class="nt">&lt;/virtualType&gt;</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th>Argument</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">fieldMapping</code></td>
      <td>Maps field names defined in the search Criteria to the names in an abstract database collection</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">defaultOrders</code></td>
      <td>The ordering applied when there are none defined in a search criteria.</td>
    </tr>
  </tbody>
</table>

<h4 id="pagination-processor">Pagination Processor</h4>

<p>The <a href="https://github.com/magento/magento2/blob/2.2/lib/internal/Magento/Framework/Api/SearchCriteria/CollectionProcessor/PaginationProcessor.php" target="_blank"><code class="highlighter-rouge">PaginationProcessor</code></a> class applies the current page and page size of the search criteria to an abstract database collection.</p>

<h4 id="join-processor">Join Processor</h4>

<p>The <a href="https://github.com/magento/magento2/blob/2.2/lib/internal/Magento/Framework/Api/SearchCriteria/CollectionProcessor/JoinProcessor.php" target="_blank"><code class="highlighter-rouge">JoinProcessor</code></a> class allows you to join fields from other tables into an abstract database collection.</p>

<p>Below is an example of creating a Join Processor virtual type in the <code class="highlighter-rouge">di.xml</code> file named <code class="highlighter-rouge">Magento\Tax\Model\Api\SearchCriteria\CollectionProcessor\TaxRuleJoinProcessor</code>:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;virtualType</span> <span class="na">name=</span><span class="s">"Magento\Tax\Model\Api\SearchCriteria\CollectionProcessor\TaxRuleJoinProcessor"</span> <span class="na">type=</span><span class="s">"Magento\Framework\Api\SearchCriteria\CollectionProcessor\JoinProcessor"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;arguments&gt;</span>
    <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"customJoins"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"rate.tax_calculation_rate_id"</span> <span class="na">xsi:type=</span><span class="s">"object"</span><span class="nt">&gt;</span>Magento\Tax\Model\Api\SearchCriteria\JoinProcessor\Rate<span class="nt">&lt;/item&gt;</span>
      <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"ctc.customer_tax_class_id"</span> <span class="na">xsi:type=</span><span class="s">"object"</span><span class="nt">&gt;</span>Magento\Tax\Model\Api\SearchCriteria\JoinProcessor\CustomerTaxClass<span class="nt">&lt;/item&gt;</span>
      <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"ptc.product_tax_class_id"</span> <span class="na">xsi:type=</span><span class="s">"object"</span><span class="nt">&gt;</span>Magento\Tax\Model\Api\SearchCriteria\JoinProcessor\ProductTaxClass<span class="nt">&lt;/item&gt;</span>
      <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"cd.customer_tax_class_id"</span> <span class="na">xsi:type=</span><span class="s">"object"</span><span class="nt">&gt;</span>Magento\Tax\Model\Api\SearchCriteria\JoinProcessor\CalculationData<span class="nt">&lt;/item&gt;</span>
      <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"cd.product_tax_class_id"</span> <span class="na">xsi:type=</span><span class="s">"object"</span><span class="nt">&gt;</span>Magento\Tax\Model\Api\SearchCriteria\JoinProcessor\CalculationData<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;/argument&gt;</span>
    <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"fieldMapping"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>tax_calculation_rule_id<span class="nt">&lt;/item&gt;</span>
      <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"tax_rate_ids"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>tax_calculation_rate_id<span class="nt">&lt;/item&gt;</span>
      <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"customer_tax_class_ids"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>cd.customer_tax_class_id<span class="nt">&lt;/item&gt;</span>
      <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"product_tax_class_ids"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>cd.product_tax_class_id<span class="nt">&lt;/item&gt;</span>
      <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"tax_calculation_rate_id"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>rate.tax_calculation_rate_id<span class="nt">&lt;/item&gt;</span>
    <span class="nt">&lt;/argument&gt;</span>
  <span class="nt">&lt;/arguments&gt;</span>
<span class="nt">&lt;/virtualType&gt;</span></code></pre></figure>

<p>The Join Processor aggregates Custom Joins objects implementing the interface <a href="https://github.com/magento/magento2/blob/2.2/lib/internal/Magento/Framework/Api/SearchCriteria/CollectionProcessor/JoinProcessor/CustomJoinInterface.php" target="_blank"><code class="highlighter-rouge">CustomJoinInterface</code></a>.</p>

<div class="collapsible"><b class="collapsible-title">Show Custom Join implementation example </b><div class="collapsible-content"><figure class="highlight"><pre><code class="language-php" data-lang="php">    namespace Magento\Tax\Model\Api\SearchCriteria\JoinProcessor;

    use Magento\Framework\Api\SearchCriteria\CollectionProcessor\JoinProcessor\CustomJoinInterface;
    use Magento\Framework\Data\Collection\AbstractDb;

    /**
     * Class Rate
     * @package Magento\Tax\Model\Api\SearchCriteria\JoinProcessor
     **/
    class Rate implements CustomJoinInterface
    {
        /**
         * @param \Magento\Tax\Model\ResourceModel\Calculation\Rule\Collection $collection
         * @return true
         **/
        public function apply(AbstractDb $collection)
        {
            $collection-&gt;joinCalculationData('rate');
            return true;
        }
    }</code></pre></figure>
</div></div>

<h3 id="using-collection-processors-in-repositories">Using Collection Processors in Repositories</h3>

<p>Below is an example of how the <a href="https://github.com/magento/magento2/blob/2.2/app/code/Magento/Customer/Model/ResourceModel/CustomerRepository.php" target="_blank"><code class="highlighter-rouge">CustomerRepositoryInterface</code></a> repository class uses a Collection Processor.</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">    namespace Magento\Customer\Model\ResourceModel;

    ...

    /**
     * Customer repository.
     * @SuppressWarnings(PHPMD.CouplingBetweenObjects)
     **/
    class CustomerRepository implements \Magento\Customer\Api\CustomerRepositoryInterface
    {
        ...

        /**
         * @var \Magento\Framework\Api\SearchCriteria\CollectionProcessorInterface
         **/
        private $collectionProcessor;

        ...

        public function __construct(
            ...
            CollectionProcessorInterface $collectionProcessor = null
        ) {
            ...
            $this-&gt;collectionProcessor = $collectionProcessor ?: $this-&gt;getCollectionProcessor();
        }

        ...

        /**
         * {@inheritdoc}
         **/
        public function getList(SearchCriteriaInterface $searchCriteria)
        {
            ...

            $this-&gt;getCollectionProcessor()-&gt;process($searchCriteria, $collection);

            ...
        }

        ...

        /**
         * Retrieve collection processor
         *
         * @deprecated
         * @return \Magento\Framework\Api\SearchCriteria\CollectionProcessorInterface
         **/
        private function getCollectionProcessor()
        {
            if (!$this-&gt;collectionProcessor) {
                $this-&gt;collectionProcessor = \Magento\Framework\App\ObjectManager::getInstance()-&gt;get(
                    'Magento\Eav\Model\Api\SearchCriteria\CollectionProcessor'
                );
            }
            return $this-&gt;collectionProcessor;
        }
    }</code></pre></figure>

<p>The <code class="highlighter-rouge">di.xml</code> configuration file excerpt below shows how you can create a virtual type for the Collection Processor by passing in a custom Filter Processor and a custom Sorting Processor.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">    <span class="nt">&lt;virtualType</span> <span class="na">name=</span><span class="s">"Magento\Customer\Model\Api\SearchCriteria\CollectionProcessor\CustomerFilterProcessor"</span> <span class="na">type=</span><span class="s">"Magento\Eav\Model\Api\SearchCriteria\CollectionProcessor\FilterProcessor"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;arguments&gt;</span>
            <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"customFilters"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"category_id"</span> <span class="na">xsi:type=</span><span class="s">"object"</span><span class="nt">&gt;</span>Magento\Customer\Model\Api\SearchCriteria\CollectionProcessor\FilterProcessor\CustomerCategoryFilter<span class="nt">&lt;/item&gt;</span>
            <span class="nt">&lt;/argument&gt;</span>
            <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"fieldMapping"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"code"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>customer_group_code<span class="nt">&lt;/item&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>customer_group_id<span class="nt">&lt;/item&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"tax_class_name"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>class_name<span class="nt">&lt;/item&gt;</span>
            <span class="nt">&lt;/argument&gt;</span>
        <span class="nt">&lt;/arguments&gt;</span>
    <span class="nt">&lt;/virtualType&gt;</span>
    <span class="nt">&lt;virtualType</span> <span class="na">name=</span><span class="s">"Magento\Customer\Model\Api\SearchCriteria\CollectionProcessor\CustomerSortingProcessor"</span> <span class="na">type=</span><span class="s">"Magento\Framework\Api\SearchCriteria\CollectionProcessor\SortingProcessor"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;arguments&gt;</span>
            <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"fieldMapping"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"code"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>customer_group_code<span class="nt">&lt;/item&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>customer_group_id<span class="nt">&lt;/item&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"tax_class_name"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>class_name<span class="nt">&lt;/item&gt;</span>
            <span class="nt">&lt;/argument&gt;</span>
            <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"defaultOrders"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>ASC<span class="nt">&lt;/item&gt;</span>
            <span class="nt">&lt;/argument&gt;</span>
        <span class="nt">&lt;/arguments&gt;</span>
    <span class="nt">&lt;/virtualType&gt;</span>
    <span class="nt">&lt;virtualType</span> <span class="na">name=</span><span class="s">"Magento\Customer\Model\Api\SearchCriteria\CustomerCollectionProcessor"</span> <span class="na">type=</span><span class="s">"Magento\Eav\Model\Api\SearchCriteria\CollectionProcessor"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;arguments&gt;</span>
            <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"processors"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"filters"</span> <span class="na">xsi:type=</span><span class="s">"object"</span><span class="nt">&gt;</span>Magento\Customer\Model\Api\SearchCriteria\CollectionProcessor\CustomerFilterProcessor<span class="nt">&lt;/item&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"sorting"</span> <span class="na">xsi:type=</span><span class="s">"object"</span><span class="nt">&gt;</span>Magento\Customer\Model\Api\SearchCriteria\CollectionProcessor\CustomerSortingProcessor<span class="nt">&lt;/item&gt;</span>
                <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"pagination"</span> <span class="na">xsi:type=</span><span class="s">"object"</span><span class="nt">&gt;</span>Magento\Framework\Api\SearchCriteria\CollectionProcessor\PaginationProcessor<span class="nt">&lt;/item&gt;</span>
            <span class="nt">&lt;/argument&gt;</span>
        <span class="nt">&lt;/arguments&gt;</span>
    <span class="nt">&lt;/virtualType&gt;</span>
    <span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">"Magento\Customer\Model\ResourceModel\CustomerRepository"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;arguments&gt;</span>
            <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"collectionProcessor"</span> <span class="na">xsi:type=</span><span class="s">"object"</span><span class="nt">&gt;</span>Magento\Customer\Model\Api\SearchCriteria\CustomerCollectionProcessor<span class="nt">&lt;/argument&gt;</span>
        <span class="nt">&lt;/arguments&gt;</span>
    <span class="nt">&lt;/type&gt;</span></code></pre></figure>


		</div>
		<!-- /.content-wrap -->

		<div class="page-info">

  

  
   <div class="github-link">
     <a class="improve-page" href="https://github.com/magento/devdocs/tree/develop/guides/v2.2/extension-dev-guide/repositories.md" target="_blank">
       Edit this page on GitHub
     </a>
   </div>
  

  <div class="new-issue">
    <a href="https://github.com/magento/devdocs/issues/new?title=&body=Feedback on page: /guides/v2.2/extension-dev-guide/searching-with-repositories.html" target="_blank">Give us feedback</a>
  </div>

</div>


	</section>
	<!-- /.content -->

</div> <!-- /.container -->


	</div>
	<!-- /.main-container -->

</div>
<!-- /#gl-wrapper -->

<!-- footer-->
<div id="footer">
  <div class="container">

    <div class="copyright-links">
      <ul class="nav">
        <li><a href="/guides/v2.2/contributor-guide/contributing_docs.html">Become a Contributor</a>
        <li><a href="https://magento.github.io/glossary/index.html?audience=developer">Glossary</a></li>
        <li><a href="http://magento.com/legal/terms/privacy/">Privacy Policy</a></li>
        <li><a href="http://magento.com/legal/terms/">Terms of Service</a></li>
        <li><a href="http://magento.com/legal/licensing/">License/Trademark FAQ</a></li>
        <li><a href="/guides/v2.2/release-notes/bk-release-notes.html">Release Notes</a></li>
        <li><a href="/magento-third-party.html">Third-Party Licenses</a></li> 
      </ul>
    </div>

		<div class="copyright-date">&copy; 2017 Magento. All rights reserved.</div>

  </div>
</div>
<!-- / #footer -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="/common/js/app.min.js"></script>

<!-- Glossary integration -->
<script src="https://cdn.jsdelivr.net/jquery.webui-popover/1.2.1/jquery.webui-popover.min.js"></script>
<script src="/common/js/glossary.tooltip.min.js"></script>
<script>
    $(document).ready(function(){
      magento.glossary.init("https://magento.github.io/glossary/data/content-glossary.xml",function(term){return term.types.includes("glossary");},magento.glossary.tooltip.init);
      });
</script>

<script type="text/javascript">
    (function() {
        var didInit = false;
        function initMunchkin() {
            if(didInit === false) {
                didInit = true;
                Munchkin.init('585-GGD-959', {cookieAnon: false});
            }
        }
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.async = true;
        s.src = '//munchkin.marketo.net/munchkin.js';
        s.onreadystatechange = function() {
            if (this.readyState == 'complete' || this.readyState == 'loaded') {
                initMunchkin();
            }
        };
        s.onload = initMunchkin;
        document.getElementsByTagName('head')[0].appendChild(s);
    })();
</script>



<!--Google Analytics-->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-66243208-1', 'auto');
    ga('send', 'pageview');
</script>


</body>
</html>


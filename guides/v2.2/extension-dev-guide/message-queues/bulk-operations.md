---
group: extension-dev-guide
subgroup: 99_Module Development
title: Bulk Operations
menu_title: Bulk Operations
menu_order: 28
version: 2.2
ee_only: True
level3_menu_node: level3child
level3_subgroup: mq
redirect_from: /guides/v2.2/extension-dev-guide/bulk-operations.html
functional_areas:
  - Services
---

Bulk operations are actions that are performed on a large scale. Example bulk operations tasks include importing or exporting items, changing prices on a mass scale, and assigning products to a warehouse.

For each individual task of a bulk operation, the system creates a message that is published in a [message queue]( {{ page.baseurl }}/config-guide/mq/rabbitmq-overview.html). A consumer runs in the background and processes the messages that it receives. Because tasks are processed in the background through the message queue system, when a merchant launches a bulk operation from the {% glossarytooltip 29ddb393-ca22-4df9-a8d4-0024d75739b1 %}Admin{% endglossarytooltip %} panel, control is quickly returned to the merchant. In previous releases, the merchant could not use the Admin panel until all tasks were completed.

The primary Bulk Operation interface is `OperationInterface`. It defines the getter and setter methods the bulk operation uses to create and process messages. The following interfaces are also used:

Interface | Description
--- | ---
BulkManagementInterface | Schedules and deletes bulk operation requests
BulkStatusInferface | Returns the status of bulk operations
BulkSummaryInterface | Provides details about a bulk operation
OperationManagementInterface | Changes the status of an operation

Three clients call bulk operation APIs:

* A publisher, which pushes messages to the message queue
* A consumer, which handles each specific operation
* A client that gets the status of the bulk operation and shows the list of failed operations

### Publish bulk operations

The `BulkManagementInterface::scheduleBulk` is responsible for publishing bulk operations. The following table describes its arguments.

<table>
<tr><th>Parameter</th><th>Type</th><th>Description</th></tr>
<tr><td>$bulkUuid</td>
<td>string</td>
<td>Bulk identifier generated by
<code>Magento\Framework\DataObject\IdentityGeneratorInterface::generateId</code></td></tr>
<tr><td>$operations</td>
<td>array</td>
<td>
<ul><li><p>topic_name - Must be defined in the <code>communication.xml</code> and queue configuration files.</p></li>
<li><p>bulk_uuid -  A bulk identifier </p></li>
<li><p>status -  The default operation status <code>OperationInterface::STATUS_TYPE_OPEN</code></p></li>
<li><p>serialized_data - An array of serialized data with the following required keys:</p></li>
  <ul><li><p>entity_id - Your {% glossarytooltip a9027f5d-efab-4662-96aa-c2999b5ab259 %}entity{% endglossarytooltip %} ID</p></li>
  <li><p>entity_link - Link to your entity</p></li>
  <li><p>meta_info - String that describes your entity. For example, "SKU: Simple_Product"</p></li></ul>
<p>This data is required to display the results of operations couldn't be executed for any non-recoverable reason. These results are displayed in the failed operations grid.</p>
<p>You also can add any data needed to execute operations. For example, if you are conducting a mass price update, you can add price data.</p>
</ul>
</td></tr>
<tr><td>$bulkDescription</td>
<td>string</td>
<td>A description of the bulk operation. This value is displayed in the <b>Your Bulk Operations</b> grid.</td></tr>
<tr><td>$userId</td>
<td>int</td>
<td>The Admin user ID that executes this bulk operation.</td></tr>
</table>

See [Create a publisher]( {{ page.baseurl }}/extension-dev-guide/message-queues/implement-bulk.html#createpublisher) for a detailed example of a {% glossarytooltip d5777fe2-f786-45d9-b052-cca8a10120d9 %}publisher{% endglossarytooltip %}.

### Consume messages

When a consumer processes a message, it must notify the system of its status. The status can be OPEN, COMPLETE, RETRIABLY_FAILED, and NOT_RETRIABLY_FAILED.

To send this notification, use `OperationManagementInterface::changeOperationStatus($operationId, $status, $message = null, $data = null)`.

#### Handling Recoverable Exceptions

Magento provides database exception classes to simplify the process of identifying recoverable database errors in client code. In most cases, such errors happen due to some environment issues and can be fixed. The full path to these classes is `Magento\Framework\DB\Adapter\<class_name>`. These exceptions extend generic `\Zend_Db_Adapter_Exception`.

Exception class | Description of database error(s)
--- | ---
ConnectionException	| SQLSTATE[HY000]: General error: 2006 MySQL server has gone away <BR>SQLSTATE[HY000]: General error: 2013 Lost connection to MySQL server during query
LockWaitException | SQLSTATE[HY000]: General error: 1205 Lock wait timeout exceeded
DeadlockException	| SQLSTATE[40001]: Serialization failure: 1213 Deadlock found when trying to get lock

The following pseudocode illustrates how to recover from database-related errors.

{% highlight php startinline=true %}
<?php
namespace example;
use Magento\Framework\DB\Adapter\LockWaitException;

// ...
try {
    // do something
} catch (LockWaitException $exception) {
    // try to recover from exception
}
{% endhighlight %}


See [Create a publisher]( {{ page.baseurl }}/extension-dev-guide/message-queues/implement-bulk.html#createconsumer) for a detailed example of a consumer.

### Get the status of operations

Use `getBulkStatus(UuidInterface $bulkId)` to get the status of the overall bulk operation.  Possible values are

Value | Constant
--- | ---
0 | NOT_STARTED
1 | IN_PROGRESS
2 | FINISHED_SUCCESFULLY
3 | FINISHED_WITH_FAILURE

#### Related Topic

* [Message Queues Overview]( {{ page.baseurl }}/config-guide/mq/rabbitmq-overview.html)
* [Example bulk operations implementation]({{ page.baseurl }}/extension-dev-guide/message-queues/implement-bulk.html)

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>Architecture layers</title>
	<meta name="description" content="Magento 2 Developer Documentation.
">
	<meta http-equiv="last-modified" content="" />

	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,700,600,300,800' rel='stylesheet' type='text/css'>

	<link rel="stylesheet" href="/css/app.css" />
	<link rel="stylesheet" href="/css/print.css" media="print" />
	<link rel="canonical" href="//guides/v2.0/architecture/archi_perspectives/arch_layers.html">

  <script>
    var baseUrl = "/";
  </script>

	<!-- crazyegg -->
	<script type="text/javascript">
	setTimeout(function(){var a=document.createElement("script");
	var b=document.getElementsByTagName("script")[0];
	a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0038/0321.js?"+Math.floor(new Date().getTime()/3600000);
	a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
	</script>

</head>
<body>

<header class="site-header">

	<nav id="global-nav">

		<div class="menu-btn"><a class="menu-trigger menu-icon" href="#"></a></div>

		<div class="container">

			<a class="logo" href="/guides/v2.0/"><img src="/i/m-logo.svg" alt=""><img src="/i/magento-logo.svg" alt="Magento" class="magento-logo" /><img src="/i/devdocs-logo.svg" alt="Devdocs" class="devdocs-logo" /></a>

			
<div class="version-switcher dropdown">
	<button class="btn dropdown-toggle" data-toggle="dropdown">
		Magento 2.0
	</button>

	<ul class="dropdown-menu dropdown-menu-left">
	
		<li><a class="dropdown-item" href="/guides/v2.0/architecture/archi_perspectives/arch_layers.html">Magento 2.0</a></li>
	
		<li><a class="dropdown-item" href="/guides/v2.1/architecture/archi_perspectives/arch_layers.html">Magento 2.1</a></li>
	
  </ul>

</div>



			<!-- Main Navigation -->
<div class="nav-main">
  <ul>
    <li class="first">
      <a href="#">Setup and Deployment</a>
        <ul class="menu nav">
            <li><a href="/guides/v2.0/install-gde/bk-install-guide.html">Installation Guide</a></li>
          
          <li class="leaf"><a href="/guides/v2.0/comp-mgr/bk-compman-upgrade-guide.html">Component Manager and System Upgrade Guide</a></li>
          
          <li class="leaf"><a href="/guides/v2.0/config-guide/bk-config-guide.html">Configuration Guide</a></li>
          <li class="leaf"><a href="/guides/v2.0/migration/bk-migration-guide.html">Migration Guide</a></li>
          <li class="leaf"><a href="/guides/v2.0/cloud/bk-cloud.html">Magento Enterprise Cloud Edition Guide</a></li>
          <li class="leaf"><a href="/magento-release-information.html">Release Information</a></li>
        </ul>
    </li>

    <li>
        <a href="#">Development</a>
        <ul class="menu nav">
          <li class="leaf"><a href="/guides/v2.0/extension-dev-guide/bk-extension-dev-guide.html">PHP Developer Guide</a></li>
          <li class="leaf"><a href="/guides/v2.0/ext-best-practices/bk-ext-best-practices.html">Extension Developer Best Practices</a></li>
          <li><a href="/guides/v2.0/payments-integrations/bk-payments-integrations.html">Payments Integrations</a></li>
          <li class="leaf"><a href="/guides/v2.0/architecture/bk-architecture.html">Magento Architecture</a></li>
          <li class="leaf"><a href="/guides/v2.0/mrg/intro.html">Module Reference Guide</a></li>
          <li class="leaf"><a href="/guides/v2.0/coding-standards/bk-coding-standards.html">Coding Standards</a></li>
          
          <li class="first leaf"><a href="/guides/v2.0/contributor-guide/contributing.html">Contributor Guide</a></li>
        </ul>
    </li>

    <li>
        <a href="#">Frontend</a>
        <ul class="menu nav">
          <li class="first leaf"><a href="/guides/v2.0/frontend-dev-guide/bk-frontend-dev-guide.html">Frontend Developer Guide</a></li>
          
          <li class="leaf"><a href="/guides/v2.0/ui-components/ui-component.html">UI Components</a></li>
          
          <li class="leaf"><a href="/guides/v2.0/javascript-dev-guide/bk-javascript-dev-guide.html">JavaScript Developer Guide</a></li>
          <li class="leaf"><a href="/guides/v2.0/pattern-library/bk-pattern.html">Admin Design Pattern Library</a></li>
          <li class="leaf"><a href="/guides/v2.0/design-styleguide/bk-styleguide.html">Admin Style Guide</a></li>
        </ul>
    </li>

    <li>
        <a href="#">API</a>
        <ul class="menu nav">
          <li class="leaf"><a href="/guides/v2.0/get-started/bk-get-started-api.html">Get Started with Magento Web APIs</a></li>
          <li class="leaf"><a href="/guides/v2.0/rest/bk-rest.html">REST API Reference</a></li>
          <li class="leaf"><a href="/guides/v2.0/soap/bk-soap.html">SOAP API Reference</a></li>
        </ul>
    </li>

    <li>
        <a href="#">Testing</a>
        <ul class="menu nav">
          <li class="leaf"><a href="/guides/v2.0/test/testing.html">Magento Testing Guide</a></li>
          <li class="leaf"><a href="/guides/v2.0/mtf/mtf_introduction.html">Functional Testing</a></li>
          <li class="leaf"><a href="/guides/v2.0/test/integration/integration_test_execution.html">Integration Testing</a></li>
          <li class="leaf"><a href="/guides/v2.0/test/js/jasmine.html">JavaScript Unit Testing</a></li>
          <li class="leaf"><a href="/guides/v2.0/test/unit/unit_test_execution.html">PHP Unit Testing</a></li>
          <li class="leaf"><a href="/guides/v2.0/get-started/web-api-functional-testing.html">Web API Functional Testing</a></li>
        </ul>
    </li>

    <li>
      <a href="/guides/v2.0/howdoi/bk-how-do-i.html">How Tos</a>
    </li>
  </ul>
</div><!-- /.nav-main -->


			<div class="search-btn">
				<a class="search-trigger search-icon" href="/search.html"></a>
			</div>

			<form class="quick-search" action="/search.html" method="get">
				<input type="search" name="q" placeholder="Search" />
				<a href="#" class="quick-search-close">&times;</a>
			</form>





		</div>

	</nav><!-- #global-nav -->

</header>
<div class="nav-main-fader"></div>


<div id="gl-wrapper">

	<!-- .main-container -->
	<div class="main-container">
		<a id="main-content"></a>


<div class="container">

	<!-- sidebar -->
<aside class="sidebar">
	<a href="#" class="toc-toggler">Table of Contents</a>
	<div class="sidebar-wrapper">






		<ul>

		

		

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

				

			

		</ul>

	</div>
</aside>
<!-- /sidebar -->


	<section class="content">
		<div class="content-wrap">
			<!-- page-header -->
<section class="page-intro">
	

  <nav class="breadcrumbs">

    <a class="breadcrumb-item" href="/guides/v2.0/"><span>Home</span></a>

    <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

    <!-- Iteration breadcrumb item -->
    
    
    

    </ol>

  </nav>


	
	<h1 class="page-heading">Architecture layers</h1>

  


</section>

			<h2 id="magento-framework">Magento Framework</h2>

<h3 id="overview">Overview</h3>

<p>The Magento Framework controls how application components interact, including request flow, routing, indexing, caching, and exception handling. It provides services that reduce the effort of creating modules that contain business logic, contributing to the goal of both making Magento code more modular as well as decreasing dependencies.</p>

<p>This primarily PHP software component is organized into logical groups called <i>libraries</i>, which all modules can call.  Most of the framework code sits under the domain layer or encloses the presentation, service, and domain layers. The framework contains no business logic.
(Although the Magento Framework does not contain resource models, it does contain a library of code to help implement a resource model.)</p>

<div class="bs-callout bs-callout-info" id="info">
  <p>Don’t confuse the Magento framework with the Zend web application framework that ships with Magento.</p>
</div>

<p>You should never modify the framework files, although if you are extending Magento, you must know how to call the framework libraries. Modules you create will typically inherit from classes and interfaces defined in the framework directories.  </p>

<h3 id="functions">Functions</h3>

<p>The Magento framework provides libraries that help reduce the effort of creating modules that contain business logic.</p>

<p>The framework is responsible for operations that are useful for potentially all modules, including:</p>

<ul>
  <li>
    <p>handling HTTP protocols</p>
  </li>
  <li>
    <p>interacting with the database and filesystem</p>
  </li>
  <li>
    <p>rendering content</p>
  </li>
</ul>

<h3 id="organization">Organization</h3>

<p>Here is the Magento framework folder structure:</p>

<pre>
Lib/
    ../Internal
        ../Magento
            ../Framework
 </pre>

<ul>
  <li>
    <p><code>/lib/internal</code> contains some non-PHP as well as PHP components. Non-PHP framework libraries includes JavaScript and LESS/CSS.</p>
  </li>
  <li>
    <p><code>/lib/internal/Magento/Framework</code>  contains only PHP code. These are libraries of code plus the application entry point that routes requests to modules (that in turn call the framework libraries). For example, libraries in the framework help implement a resource model (base classes and interfaces to inherit from) but not the resource models themselves. Certain libraries also support CSS rendering.</p>
  </li>
  <li>
    <p><code>/lib/web</code> contains JavaScript and CSS/LESS files. These files reside  under <code>web</code> and not <code>internal</code> because they are accessible from a web browser, while the PHP code under <code>internal</code> is not. (Any code that a web browser must access should be under <code>web</code>, while everything else under <code>internal</code>.)</p>
  </li>
</ul>

<div class="bs-callout bs-callout-info" id="info">
  <p>The <code>lib/internal/Magento/Framework</code> directory maps to the <code>Magento\Framework</code> namespace.</p>
</div>

<h3 id="highlights-of-the-magento-framework">Highlights of the Magento Framework</h3>

<p>The Magento Framework (<code>lib/internal/Magento/Framework/</code>) provides a robust range of functionality. If you are an extension developer, you may be interested in this subset of Framework namespaces.</p>

<table>
   <tbody>
      <tr style="background-color: lightgray">
         <th>Namespace</th>
         <th>Purpose</th>

      </tr>
      <tr>
         <td><code>Magento\Framework\Object</code>
         </td>
         <td>Provides standard functionality for storing and retrieving data through magic methods. This is the base class for many Magento classes.</td>
      </tr><tr>
         <td><code>Magento\Framework\Object\Model</code>
         </td>
         <td>Contains base Model classes that almost all Magento Model classes extend from.</td>
      </tr><tr>
         <td><code>Magento\Framework\Object\AbstractModel</code>
         </td>
         <td></td>
      </tr>
      <tr>
         <td><code>Magento\Framework\Object\AbstractResource</code></td>
         <td></td>
      </tr>
      <tr>
         <td><code>Magento\Framework\Object\Controller</code></td>
         <td>Contains classes to help return different types of results (for example, JSON and redirects).</td>
      </tr>
      <tr>
         <td><code>Magento\Framework\Object\View</code></td>
         <td>Contains code to render pages and layouts.</td>
      </tr><tr>
         <td><code>Magento\Framework\Object\Data</code></td>
         <td>Contains additional classes that handle forms.</td>
      </tr><tr>
         <td><code>Magento\Framework\Object\URL</code></td>
         <td>Contains code to look up other pages in Magento.</td>
      </tr>
   </tbody>
</table>

<p>Other namespaces under <code>Magento\Framework</code> that will interest extension developers:</p>

<table>
    <tbody>
        <tr style="background-color: lightgray">
            <th>Namespace</th>
            <th>Purpose</th>
        </tr>
      <tr>
         <td><code>Magento\Framework\ObjectManager</code>
         </td>
         <td>Used to provide <i>dependency injection</i>. </td>
      </tr>
	  <tr>
         <td><code>Magento\Framework\App</code>
         </td>
         <td>Contains framework code that has knowledge about the Magento application. This code bootstraps the application and reads in the initial configuration. It also contains the entry point to the command line tools, the web application, and the cron job. And finally, it routes requests while providing the deployment context (such as reading in the configuration for the database configuration, languages, caching systems).
</td>
</tr>
<tr>
	<td>
		<code>Magento\Framework\Api</code>
	</td>
	<td>Contains base classes for advanced functionality of extendable objects through the system (that is, objects that can be extended to add new data through Magento Marketplace extensions).</td>
</tr>
<tr>
	<td>
		<code>Magento\Framework\Config</code>
	</td>
	<td>Contains the generic configuration reader. Each config file has its own specialized reader extending these classes.</td>
</tr>
<tr>
	<td>
		<code>Magento\Framework\Filesystem</code>
	</td>
	<td>Contains classes that handle reading from and writing to the file system.</td>
</tr>
	<tr>
		<td>
			<code>Magento\Framework\HTTP\PhpEnvironment</code>
		</td>
		<td />
	</tr>
	<tr>
		<td>
			<code>Magento\Framework\Session</code>
		</td>
		<td />
	</tr>
	<tr>
		<td>
			<code>Magento\Framework\Stdlib\Cookie</code>
		</td>
		<td>Code to handle the HTTP request/responses as well as session/cookies is found here.</td>
	</tr>
	<tr>
		<td>
			<code>Magento\Framework\Exception</code>
		</td>
		<td>Contains the basic exceptions that are thrown throughout the Magento codebase.</td>
	</tr>
	<tr>
		<td>
			<code>Magento\Framework\Event</code>
		</td>
		<td>Contains the code that publishes synchronous events and that handles observers for any Magento event is handled here.
		</td>
	</tr>
		<tr>
			<td>
				<code>Magento\Framework\Validator</code>
			</td>
			<td>Contains the code that validates data (currencies, not empty) and that handles observers for any Magento event.
			</td>
		</tr>
	</tbody>
</table>

<h2 id="presentation-layer">Presentation layer</h2>

<h3 id="how-presentation-code-calls-other-layers">How Presentation code calls other layers</h3>

<p>Presentation code typically calls service contracts, particularly for a store front. However, presentation code is occasionally dependent on a specific implementation that requires the presentation code to directly call the business logic layer. For example, the Admin UI screens are often tightly linked a specific implementation and are not generic across implementations.</p>

<h2 id="service-layer">Service layer</h2>

<p>The service layer provides a bridge between the presentation layer and the model layer of domain logic and resource-specific data. This is implemented using <em>service contracts</em>, which are defined using PHP interfaces.</p>

<p>In general, the service layer</p>

<ul>
  <li>
    <p>Resides below the presentation layer and above the domain layer.</p>
  </li>
  <li>
    <p>Contains service contracts, which define how the implementation will behave.</p>
  </li>
  <li>
    <p>Provides an easy way to access the REST/SOAP API framework code (which also resides above the service contracts). You can bind service contracts to web service APIs in configuration files – no coding required.</p>
  </li>
  <li>
    <p>Provides a stable API for other modules to call into.</p>
  </li>
</ul>

<h3 id="who-accesses-the-service-layer">Who accesses the service layer?</h3>

<p>All calls from web service interfaces, or users working with your storefront (that is, controller-initiated requests), are typically routed through the service layer. We strongly encourage the use of service contracts to call business logic.</p>

<p>External applications can make requests for business logic with simple SOAP and REST calls. With some simple XML or JSON, you can expose the service layer’s PHP API and make it accessible to REST or SOAP web services. Once implemented, a web service can make a single API call and return an information-rich data structure.</p>

<p>Service contract clients include:</p>

<ul>
  <li>Controllers (initiated by actions of users of the storefront)</li>
  <li>Web services (SOAP and REST API calls)</li>
  <li>Other Magento modules through service contracts</li>
</ul>

<h3 id="service-contract-anatomy">Service contract anatomy</h3>

<p>The service contract of a module is defined by the set of interfaces in the module’s <code>/Api</code>. It typically consists of:</p>

<ul>
  <li>
    <p>service interfaces in the <code>/Api</code> namespace of the module</p>
  </li>
  <li>
    <p>data (or <em>entity</em>) interfaces in the <code>Api/Data</code> directory. <em>Data entities</em> are data structures passed to and returned from service interfaces.</p>
  </li>
</ul>

<p>Typically, service contracts provide three distinct types of interfaces:</p>

<ul>
  <li>
    <p>Repository interfaces</p>
  </li>
  <li>
    <p>Management interfaces</p>
  </li>
  <li>
    <p>Metadata interfaces</p>
  </li>
</ul>

<p>However, there is no requirement that service contracts conform to all three patterns.</p>

<h3 id="advantages-of-service-contracts">Advantages of service contracts</h3>

<p>Service contracts permit you to add a new customer extension that adds or changes business logic-level resource models and models without breaking the system. How? Through the use of the &lt;preference&gt; element of a dependency injection config file (<code>di.xml</code>) file. The <code>di.xml</code> file specifies which PHP class to use for the interface <code>Magento\Customer\Api\CustomerRepositoryInterface</code>.</p>

<p>Another module can change this interface file by specifying a different class name. However, if the client code uses the interface definition only, no class change is necessary.</p>

<h3 id="related-topics">Related topics</h3>

<p>Service contracts</p>

<h2 id="domain-layer">Domain layer</h2>

<p>The domain layer holds the business logic layer of a Magento module. It typically does not contain resource-specific or database-specific information. Its primary functions include:</p>

<ul>
  <li>
    <p>Defines the generic Magento data objects, or models, that contain business logic. This logic defines which operations can be performed on particular types of data, such as a Customer object. These models contain generic information only. Applications can also use SOAP or RESTful endpoints to request data from models.</p>
  </li>
  <li>
    <p>(Optionally) Includes the implementation of service contracts, although not their definition.</p>
  </li>
</ul>

<p><strong>Best practice:</strong> Use service contracts to communicate to the domain layer by passing data types through strongly typed objects. This practice can help you avoid the need to replace presentation layer code when replacing business layer logic.</p>

<h3 id="models">Models</h3>

<p>Each domain-layer model contains a reference to a resource model, which it uses to retrieve data from the database with MySql calls.  This resource model contains logic for connecting to the underlying database, typically MySQL. A model requires a resource model only if the model data must persist.</p>

<h3 id="who-accesses-the-domain-layer">Who accesses the domain layer?</h3>

<p>There are three primary ways of accessing a module’s domain-layer code:</p>

<ul>
  <li>
    <p>Service contracts are the recommended way for one module to access another module’s domain-level code. This loosely coupled solution is the optimal way for most modules to access another module.</p>
  </li>
  <li>
    <p>A module can directly call into another module. This tightly coupled solution is not recommended for most situations, but is sometimes unavoidable.</p>
  </li>
  <li>
    <p>Domain layer code in one module can also plug itself into another module by:</p>

    <ul>
      <li>event hooks</li>
      <li>plugins</li>
      <li><code>di.xml</code> files (with an SPI contract)</li>
    </ul>
  </li>
</ul>

<p>Your strategy for calling another module’s domain-layer code is highly dependent upon the unique configuration and needs of your system.</p>

<h2 id="persistence">Persistence layer</h2>

<p>Magento uses an active record pattern strategy for persistence. In this system, the model object contains a <em>resource model</em> that maps an object to one or more database rows. A resource model is responsible for performing functions such as:</p>

<ul>
  <li>
    <p>Executing all CRUD (create, read, update, delete) requests. The resource model contains the SQL code for completing these requests.</p>
  </li>
  <li>
    <p>Performing additional business logic. For example, a resource model could perform data validation, start processes before or after data is saved, or perform other database operations.</p>
  </li>
</ul>

<p>If you expect to return multiple items from a database query, then you would implement a special type of resource model known as a <em>collection</em>. A collection is a class that loads multiple models into an array-like structure based on a set of rules. This is similar to a SQL <code>WHERE</code> clause.</p>

<p>A simple resource model defines and interacts with a single table. However, some objects have a vast number of attributes, or they could have a set related objects that have varying numbers of attributes. In these cases, the objects are constructed using Entity-Attribute-Value (EAV) models. As a result, any model that uses an EAV resource has its attributes spread out over a number of MySQL tables. The <code>Customer</code> and <code>Catalog</code> resource models use EAV attributes.</p>

<h2 id="related-topics-1">Related topics</h2>

<p><a href="/guides/v2.0/architecture/archi_perspectives/arch_diagrams.html">Architectural diagrams</a></p>

		</div>
		<!-- /.content-wrap -->

		<div class="page-info">

			

			
			 <div class="github-link">
				 <a class="improve-page" href="https://github.com/magento/devdocs/tree/develop/guides/v2.0/architecture/archi_perspectives/arch_layers.md" target="_blank">
					 Edit this page on GitHub
				 </a>
			 </div>
			

			<div class="new-issue">
				<a href="https://github.com/magento/devdocs/issues/new?title=&body=Feedback on page: /guides/v2.0/architecture/archi_perspectives/arch_layers.html" target="_blank">Give us feedback</a>
			</div>

		</div>

	</section>
	<!-- /.content -->

</div> <!-- /.container -->


	</div>
	<!-- /.main-container -->

</div>
<!-- /#gl-wrapper -->

<!-- footer-->
<div id="footer">
  <div class="container">

    <div class="copyright-links">
      <ul class="nav">
				<li><a href="/guides/v2.0/contributor-guide/contributing_docs.html">Become a Contributor</a>
        <li><a href="http://magento.com/legal/terms/privacy/">Privacy Policy</a></li>
        <li><a href="http://magento.com/legal/terms/">Terms of Service</a></li>
        <li><a href="http://magento.com/legal/licensing/">License/Trademark FAQ</a></li>
        <li><a href="/guides/v2.0/release-notes/bk-release-notes.html">Release Notes</a></li>
				<li><a href="/magento-third-party.html">Third-Party Licenses</a></li>
      </ul>
    </div>

		<div class="copyright-date">&copy; 2016 Magento. All rights reserved.</div>

  </div>
</div>
<!-- / #footer -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="/common/js/app.min.js"></script>

<script type="text/javascript">
    (function() {
        var didInit = false;
        function initMunchkin() {
            if(didInit === false) {
                didInit = true;
                Munchkin.init('585-GGD-959', {cookieAnon: false});
            }
        }
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.async = true;
        s.src = '//munchkin.marketo.net/munchkin.js';
        s.onreadystatechange = function() {
            if (this.readyState == 'complete' || this.readyState == 'loaded') {
                initMunchkin();
            }
        };
        s.onload = initMunchkin;
        document.getElementsByTagName('head')[0].appendChild(s);
    })();
</script>



<!--Google Analytics-->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-66243208-1', 'auto');
    ga('send', 'pageview');
</script>


</body>
</html>

